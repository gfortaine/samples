<?xml version="1.0" encoding="utf-8" ?>
<TrustFrameworkPolicy xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06" PolicySchemaVersion="0.3.0.0" TenantId="ribpay.onmicrosoft.com" PolicyId="B2C_1A_TrustFrameworkExtensions_passwordless_only" PublicPolicyUri="http://ribpay.onmicrosoft.com/B2C_1A_TrustFrameworkExtensions_passwordless_only">


  <BasePolicy>
    <TenantId>ribpay.onmicrosoft.com</TenantId>
    <PolicyId>B2C_1A_TrustFrameworkExtensions</PolicyId>
  </BasePolicy>
  <BuildingBlocks>

    <ClaimsSchema>
      <ClaimType Id="verificationCode">
        <DisplayName>Verification Code</DisplayName>
        <DataType>string</DataType>
        <UserHelpText>Enter your email verification code</UserHelpText>
        <UserInputType>TextBox</UserInputType>
      </ClaimType>

      <!-- Read only email address to present to the user-->
      <ClaimType Id="readonlyEmail">
        <DisplayName>E-mail Address</DisplayName>
        <DataType>string</DataType>
        <UserInputType>Readonly</UserInputType>
      </ClaimType>

      <ClaimType Id="strongAuthenticationEmailAddress">
				<DisplayName>Email Address</DisplayName>
				<DataType>string</DataType>
				<AdminHelpText>Email address that the user can use for strong authentication.</AdminHelpText>
				<UserHelpText>Email address to use for strong authentication.</UserHelpText>
				<UserInputType>TextBox</UserInputType>
			</ClaimType>

			<ClaimType Id="signInNamesInfo.emailAddress">
				<DisplayName>Email Address</DisplayName>
				<DataType>string</DataType>
				<AdminHelpText>Email address that the user can use to sign in.</AdminHelpText>
				<UserHelpText>Email address to use for signing in.</UserHelpText>
				<UserInputType>TextBox</UserInputType>
			</ClaimType>

      <ClaimType Id="country">
        <DisplayName>Country/Region</DisplayName>
        <DataType>string</DataType>
        <DefaultPartnerClaimTypes>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.AzureActiveDirectoryProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" PartnerClaimType="country" />
        </DefaultPartnerClaimTypes>
        <UserHelpText>The country/region in which you are located.</UserHelpText>
        <UserInputType>DropdownSingleSelect</UserInputType>
        <Restriction>
          <!-- The following is the approved ISO short-form Microsoft country list, taken from https://microsoft.sharepoint.com/teams/celaGlobalReadiness/Lists/CountryRegion/CountryRegionList.aspx -->
          <Enumeration Text="Afghanistan" Value="AF" />
          <Enumeration Text="Åland Islands" Value="AX" />
          <Enumeration Text="Albania" Value="AL" />
          <Enumeration Text="Algeria" Value="DZ" />
          <Enumeration Text="American Samoa" Value="AS" />
          <Enumeration Text="Andorra" Value="AD" />
          <Enumeration Text="Angola" Value="AO" />
          <Enumeration Text="Anguilla" Value="AI" />
          <Enumeration Text="Antarctica" Value="AQ" />
          <Enumeration Text="Antigua and Barbuda" Value="AG" />
          <Enumeration Text="Argentina" Value="AR" />
          <Enumeration Text="Armenia" Value="AM" />
          <Enumeration Text="Aruba" Value="AW" />
          <Enumeration Text="Australia" Value="AU" />
          <Enumeration Text="Austria" Value="AT" />
          <Enumeration Text="Azerbaijan" Value="AZ" />
          <Enumeration Text="Bahamas" Value="BS" />
          <Enumeration Text="Bahrain" Value="BH" />
          <Enumeration Text="Bangladesh" Value="BD" />
          <Enumeration Text="Barbados" Value="BB" />
          <Enumeration Text="Belarus" Value="BY" />
          <Enumeration Text="Belgium" Value="BE" />
          <Enumeration Text="Belize" Value="BZ" />
          <Enumeration Text="Benin" Value="BJ" />
          <Enumeration Text="Bermuda" Value="BM" />
          <Enumeration Text="Bhutan" Value="BT" />
          <Enumeration Text="Bolivia" Value="BO" />
          <Enumeration Text="Bonaire" Value="BQ" />
          <Enumeration Text="Bosnia and Herzegovina" Value="BA" />
          <Enumeration Text="Botswana" Value="BW" />
          <Enumeration Text="Bouvet Island" Value="BV" />
          <Enumeration Text="Brazil" Value="BR" />
          <Enumeration Text="British Indian Ocean Territory" Value="IO" />
          <Enumeration Text="British Virgin Islands" Value="VG" />
          <Enumeration Text="Brunei" Value="BN" />
          <Enumeration Text="Bulgaria" Value="BG" />
          <Enumeration Text="Burkina Faso" Value="BF" />
          <Enumeration Text="Burundi" Value="BI" />
          <Enumeration Text="Cabo Verde" Value="CV" />
          <Enumeration Text="Cambodia" Value="KH" />
          <Enumeration Text="Cameroon" Value="CM" />
          <Enumeration Text="Canada" Value="CA" />
          <Enumeration Text="Cayman Islands" Value="KY" />
          <Enumeration Text="Central African Republic" Value="CF" />
          <Enumeration Text="Chad" Value="TD" />
          <Enumeration Text="Chile" Value="CL" />
          <Enumeration Text="China" Value="CN" />
          <Enumeration Text="Christmas Island" Value="CX" />
          <Enumeration Text="Cocos (Keeling) Islands" Value="CC" />
          <Enumeration Text="Colombia" Value="CO" />
          <Enumeration Text="Comoros" Value="KM" />
          <Enumeration Text="Congo" Value="CG" />
          <Enumeration Text="Congo (DRC)" Value="CD" />
          <Enumeration Text="Cook Islands" Value="CK" />
          <Enumeration Text="Costa Rica" Value="CR" />
          <Enumeration Text="Côte d’Ivoire" Value="CI" />
          <Enumeration Text="Croatia" Value="HR" />
          <Enumeration Text="Cuba" Value="CU" />
          <Enumeration Text="Curaçao" Value="CW" />
          <Enumeration Text="Cyprus" Value="CY" />
          <Enumeration Text="Czech Republic" Value="CZ" />
          <Enumeration Text="Denmark" Value="DK" />
          <Enumeration Text="Djibouti" Value="DJ" />
          <Enumeration Text="Dominica" Value="DM" />
          <Enumeration Text="Dominican Republic" Value="DO" />
          <Enumeration Text="Ecuador" Value="EC" />
          <Enumeration Text="Egypt" Value="EG" />
          <Enumeration Text="El Salvador" Value="SV" />
          <Enumeration Text="Equatorial Guinea" Value="GQ" />
          <Enumeration Text="Eritrea" Value="ER" />
          <Enumeration Text="Estonia" Value="EE" />
          <Enumeration Text="Ethiopia" Value="ET" />
          <Enumeration Text="Falkland Islands" Value="FK" />
          <Enumeration Text="Faroe Islands" Value="FO" />
          <Enumeration Text="Fiji" Value="FJ" />
          <Enumeration Text="Finland" Value="FI" />
          <Enumeration Text="France" Value="FR" />
          <Enumeration Text="French Guiana" Value="GF" />
          <Enumeration Text="French Polynesia" Value="PF" />
          <Enumeration Text="French Southern Territories" Value="TF" />
          <Enumeration Text="Gabon" Value="GA" />
          <Enumeration Text="Gambia" Value="GM" />
          <Enumeration Text="Georgia" Value="GE" />
          <Enumeration Text="Germany" Value="DE" />
          <Enumeration Text="Ghana" Value="GH" />
          <Enumeration Text="Gibraltar" Value="GI" />
          <Enumeration Text="Greece" Value="GR" />
          <Enumeration Text="Greenland" Value="GL" />
          <Enumeration Text="Grenada" Value="GD" />
          <Enumeration Text="Guadeloupe" Value="GP" />
          <Enumeration Text="Guam" Value="GU" />
          <Enumeration Text="Guatemala" Value="GT" />
          <Enumeration Text="Guernsey" Value="GG" />
          <Enumeration Text="Guinea" Value="GN" />
          <Enumeration Text="Guinea-Bissau" Value="GW" />
          <Enumeration Text="Guyana" Value="GY" />
          <Enumeration Text="Haiti" Value="HT" />
          <Enumeration Text="Heard Island and McDonald Islands" Value="HM" />
          <Enumeration Text="Honduras" Value="HN" />
          <Enumeration Text="Hong Kong SAR" Value="HK" />
          <Enumeration Text="Hungary" Value="HU" />
          <Enumeration Text="Iceland" Value="IS" />
          <Enumeration Text="India" Value="IN" />
          <Enumeration Text="Indonesia" Value="ID" />
          <Enumeration Text="Iran" Value="IR" />
          <Enumeration Text="Iraq" Value="IQ" />
          <Enumeration Text="Ireland" Value="IE" />
          <Enumeration Text="Isle of Man" Value="IM" />
          <Enumeration Text="Israel" Value="IL" />
          <Enumeration Text="Italy" Value="IT" />
          <Enumeration Text="Jamaica" Value="JM" />
          <Enumeration Text="Jan Mayen" Value="XJ" />
          <Enumeration Text="Japan" Value="JP" />
          <Enumeration Text="Jersey" Value="JE" />
          <Enumeration Text="Jordan" Value="JO" />
          <Enumeration Text="Kazakhstan" Value="KZ" />
          <Enumeration Text="Kenya" Value="KE" />
          <Enumeration Text="Kiribati" Value="KI" />
          <Enumeration Text="Korea" Value="KR" />
          <Enumeration Text="Kosovo" Value="XK" />
          <Enumeration Text="Kuwait" Value="KW" />
          <Enumeration Text="Kyrgyzstan" Value="KG" />
          <Enumeration Text="Laos" Value="LA" />
          <Enumeration Text="Latvia" Value="LV" />
          <Enumeration Text="Lebanon" Value="LB" />
          <Enumeration Text="Lesotho" Value="LS" />
          <Enumeration Text="Liberia" Value="LR" />
          <Enumeration Text="Libya" Value="LY" />
          <Enumeration Text="Liechtenstein" Value="LI" />
          <Enumeration Text="Lithuania" Value="LT" />
          <Enumeration Text="Luxembourg" Value="LU" />
          <Enumeration Text="Macao SAR" Value="MO" />
          <Enumeration Text="Macedonia, FYRO" Value="MK" />
          <Enumeration Text="Madagascar" Value="MG" />
          <Enumeration Text="Malawi" Value="MW" />
          <Enumeration Text="Malaysia" Value="MY" />
          <Enumeration Text="Maldives" Value="MV" />
          <Enumeration Text="Mali" Value="ML" />
          <Enumeration Text="Malta" Value="MT" />
          <Enumeration Text="Marshall Islands" Value="MH" />
          <Enumeration Text="Martinique" Value="MQ" />
          <Enumeration Text="Mauritania" Value="MR" />
          <Enumeration Text="Mauritius" Value="MU" />
          <Enumeration Text="Mayotte" Value="YT" />
          <Enumeration Text="Mexico" Value="MX" />
          <Enumeration Text="Micronesia" Value="FM" />
          <Enumeration Text="Moldova" Value="MD" />
          <Enumeration Text="Monaco" Value="MC" />
          <Enumeration Text="Mongolia" Value="MN" />
          <Enumeration Text="Montenegro" Value="ME" />
          <Enumeration Text="Montserrat" Value="MS" />
          <Enumeration Text="Morocco" Value="MA" />
          <Enumeration Text="Mozambique" Value="MZ" />
          <Enumeration Text="Myanmar" Value="MM" />
          <Enumeration Text="Namibia" Value="NA" />
          <Enumeration Text="Nauru" Value="NR" />
          <Enumeration Text="Nepal" Value="NP" />
          <Enumeration Text="Netherlands" Value="NL" />
          <Enumeration Text="New Caledonia" Value="NC" />
          <Enumeration Text="New Zealand" Value="NZ" />
          <Enumeration Text="Nicaragua" Value="NI" />
          <Enumeration Text="Niger" Value="NE" />
          <Enumeration Text="Nigeria" Value="NG" />
          <Enumeration Text="Niue" Value="NU" />
          <Enumeration Text="Norfolk Island" Value="NF" />
          <Enumeration Text="North Korea" Value="KP" />
          <Enumeration Text="Northern Mariana Islands" Value="MP" />
          <Enumeration Text="Norway" Value="NO" />
          <Enumeration Text="Oman" Value="OM" />
          <Enumeration Text="Pakistan" Value="PK" />
          <Enumeration Text="Palau" Value="PW" />
          <Enumeration Text="Palestinian Authority" Value="PS" />
          <Enumeration Text="Panama" Value="PA" />
          <Enumeration Text="Papua New Guinea" Value="PG" />
          <Enumeration Text="Paraguay" Value="PY" />
          <Enumeration Text="Peru" Value="PE" />
          <Enumeration Text="Philippines" Value="PH" />
          <Enumeration Text="Pitcairn Islands" Value="PN" />
          <Enumeration Text="Poland" Value="PL" />
          <Enumeration Text="Portugal" Value="PT" />
          <Enumeration Text="Puerto Rico" Value="PR" />
          <Enumeration Text="Qatar" Value="QA" />
          <Enumeration Text="Réunion" Value="RE" />
          <Enumeration Text="Romania" Value="RO" />
          <Enumeration Text="Russia" Value="RU" />
          <Enumeration Text="Rwanda" Value="RW" />
          <Enumeration Text="Saba" Value="XS" />
          <Enumeration Text="Saint Barthélemy" Value="BL" />
          <Enumeration Text="Saint Kitts and Nevis" Value="KN" />
          <Enumeration Text="Saint Lucia" Value="LC" />
          <Enumeration Text="Saint Martin" Value="MF" />
          <Enumeration Text="Saint Pierre and Miquelon" Value="PM" />
          <Enumeration Text="Saint Vincent and the Grenadines" Value="VC" />
          <Enumeration Text="Samoa" Value="WS" />
          <Enumeration Text="San Marino" Value="SM" />
          <Enumeration Text="São Tomé and Príncipe" Value="ST" />
          <Enumeration Text="Saudi Arabia" Value="SA" />
          <Enumeration Text="Senegal" Value="SN" />
          <Enumeration Text="Serbia" Value="RS" />
          <Enumeration Text="Seychelles" Value="SC" />
          <Enumeration Text="Sierra Leone" Value="SL" />
          <Enumeration Text="Singapore" Value="SG" />
          <Enumeration Text="Sint Eustatius" Value="XE" />
          <Enumeration Text="Sint Maarten" Value="SX" />
          <Enumeration Text="Slovakia" Value="SK" />
          <Enumeration Text="Slovenia" Value="SI" />
          <Enumeration Text="Solomon Islands" Value="SB" />
          <Enumeration Text="Somalia" Value="SO" />
          <Enumeration Text="South Africa" Value="ZA" />
          <Enumeration Text="South Georgia and the South Sandwich Islands" Value="GS" />
          <Enumeration Text="South Sudan" Value="SS" />
          <Enumeration Text="Spain" Value="ES" />
          <Enumeration Text="Sri Lanka" Value="LK" />
          <Enumeration Text="St Helena, Ascension, Tristan da Cunha" Value="SH" />
          <Enumeration Text="Sudan" Value="SD" />
          <Enumeration Text="Suriname" Value="SR" />
          <Enumeration Text="Svalbard" Value="SJ" />
          <Enumeration Text="Swaziland" Value="SZ" />
          <Enumeration Text="Sweden" Value="SE" />
          <Enumeration Text="Switzerland" Value="CH" />
          <Enumeration Text="Syria" Value="SY" />
          <Enumeration Text="Taiwan" Value="TW" />
          <Enumeration Text="Tajikistan" Value="TJ" />
          <Enumeration Text="Tanzania" Value="TZ" />
          <Enumeration Text="Thailand" Value="TH" />
          <Enumeration Text="Timor-Leste" Value="TL" />
          <Enumeration Text="Togo" Value="TG" />
          <Enumeration Text="Tokelau" Value="TK" />
          <Enumeration Text="Tonga" Value="TO" />
          <Enumeration Text="Trinidad and Tobago" Value="TT" />
          <Enumeration Text="Tunisia" Value="TN" />
          <Enumeration Text="Turkey" Value="TR" />
          <Enumeration Text="Turkmenistan" Value="TM" />
          <Enumeration Text="Turks and Caicos Islands" Value="TC" />
          <Enumeration Text="Tuvalu" Value="TV" />
          <Enumeration Text="U.S. Outlying Islands" Value="UM" />
          <Enumeration Text="U.S. Virgin Islands" Value="VI" />
          <Enumeration Text="Uganda" Value="UG" />
          <Enumeration Text="Ukraine" Value="UA" />
          <Enumeration Text="United Arab Emirates" Value="AE" />
          <Enumeration Text="United Kingdom" Value="GB" />
          <Enumeration Text="United States" Value="US" />
          <Enumeration Text="Uruguay" Value="UY" />
          <Enumeration Text="Uzbekistan" Value="UZ" />
          <Enumeration Text="Vanuatu" Value="VU" />
          <Enumeration Text="Vatican City" Value="VA" />
          <Enumeration Text="Venezuela" Value="VE" />
          <Enumeration Text="Vietnam" Value="VN" />
          <Enumeration Text="Wallis and Futuna" Value="WF" />
          <Enumeration Text="Yemen" Value="YE" />
          <Enumeration Text="Zambia" Value="ZM" />
          <Enumeration Text="Zimbabwe" Value="ZW" />
        </Restriction>
      </ClaimType>

      <ClaimType Id="extension_termsOfUseConsentChoice">
        <DisplayName></DisplayName>
        <DataType>string</DataType>
        <UserInputType>CheckboxMultiSelect</UserInputType>
        <Restriction>
          <Enumeration Text=" I agree to the Terms Of Service" Value="AgreeToTermsOfUseConsentYes" SelectByDefault="false" />
        </Restriction>
      </ClaimType>

      <ClaimType Id="currentTime">
        <DisplayName>Current Time</DisplayName>
        <DataType>dateTime</DataType>
        <AdminHelpText>Current date time in UTC.</AdminHelpText>
        <UserHelpText>Current date time in UTC.</UserHelpText>
      </ClaimType>

      <ClaimType Id="extension_termsOfUseConsentDateTime">
        <DisplayName>Terms of Use Consent Date Time</DisplayName>
        <DataType>dateTime</DataType>
        <AdminHelpText>Terms of Use Consent date time in UTC.</AdminHelpText>
        <UserHelpText>Terms of Use Consent date time in UTC.</UserHelpText>
      </ClaimType>

      <ClaimType Id="termsOfUseConsentRequired">
        <DisplayName>Terms of Use Consent Required</DisplayName>
        <DataType>boolean</DataType>
        <AdminHelpText>Boolean that specifies if Terms of Use Consent is required or not.</AdminHelpText>
        <UserHelpText>Boolean that specifies if Terms of Use Consent is required or not</UserHelpText>
      </ClaimType>

      <ClaimType Id="extension_termsOfUseConsentVersion">
        <DisplayName>Terms of Use Consent Version</DisplayName>
        <DataType>string</DataType>
        <AdminHelpText>Terms of Use Consent Version.</AdminHelpText>
        <UserHelpText>Terms of Use Consent Version.</UserHelpText>
      </ClaimType>

    </ClaimsSchema>

    <ClaimsTransformations>

      <ClaimsTransformation Id="CreateReadonlyEmailClaim" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="{0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="readonlyEmail" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CopyEmailAddressIntoDisplayName" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="{0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="displayName" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateRandomPassword" TransformationMethod="CreateRandomString">
        <InputParameters>
          <InputParameter Id="randomGeneratorType" DataType="string" Value="GUID"/>
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="newPassword" TransformationClaimType="outputClaim"/>
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="GetCurrentDateTime" TransformationMethod="GetCurrentDateTime">
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="currentTime" TransformationClaimType="currentDateTime" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="IsTermsOfUseConsentRequiredForDateTime" TransformationMethod="IsTermsOfUseConsentRequired">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="extension_termsOfUseConsentDateTime" TransformationClaimType="termsOfUseConsentDateTime" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="termsOfUseTextUpdateDateTime" DataType="dateTime" Value="2020-01-30T23:03:45" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="termsOfUseConsentRequired" TransformationClaimType="result" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="GetNewUserAgreeToTermsOfUseConsentVersion" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="V1" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="extension_termsOfUseConsentVersion" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <!-- Not used here, but this OR IsTermsOfUseConsentRequiredForDateTime check can be used -->
      <ClaimsTransformation Id="IsTermsOfUseConsentRequiredForVersion" TransformationMethod="CompareClaimToValue">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="extension_termsOfUseConsentVersion" TransformationClaimType="inputClaim1" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="compareTo" DataType="string" Value="V2" />
          <InputParameter Id="operator" DataType="string" Value="not equal" />
          <InputParameter Id="ignoreCase" DataType="string" Value="true" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="termsOfUseConsentRequired" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

    </ClaimsTransformations>

    <ContentDefinitions>
      <ContentDefinition Id="api.localaccount.emailVerification">
        <LoadUri>~/tenant/templates/AzureBlue/selfAsserted.cshtml</LoadUri>
        <RecoveryUri>~/common/default_page_error.html</RecoveryUri>
        <DataUri>urn:com:microsoft:aad:b2c:elements:contract:selfasserted:2.1.20</DataUri>
        <Metadata>
          <Item Key="DisplayName">Collect information from user page</Item>
        </Metadata>
        <LocalizedResourcesReferences MergeBehavior="Prepend">
          <LocalizedResourcesReference Language="en" LocalizedResourcesReferenceId="api.localaccount.emailVerification.en" />
          <!-- Add more languages here -->
          <LocalizedResourcesReference Language="fr" LocalizedResourcesReferenceId="api.localaccount.emailVerification.fr" />
        </LocalizedResourcesReferences>
      </ContentDefinition>
      <ContentDefinition Id="api.localaccountsignup">
        <LoadUri>https://ribpay.blob.core.windows.net/azure-ad-b2c/customize-ui.html</LoadUri>
        <DataUri>urn:com:microsoft:aad:b2c:elements:contract:selfasserted:2.1.20</DataUri>
        <LocalizedResourcesReferences MergeBehavior="Prepend">
          <LocalizedResourcesReference Language="en" LocalizedResourcesReferenceId="api.localaccountsignup.en" />
          <!-- Add more languages here -->
          <LocalizedResourcesReference Language="fr" LocalizedResourcesReferenceId="api.localaccountsignup.fr" />
        </LocalizedResourcesReferences>
      </ContentDefinition>
      <ContentDefinition Id="api.localaccountpasswordreset">
        <DataUri>urn:com:microsoft:aad:b2c:elements:contract:selfasserted:2.1.20</DataUri>
        <LocalizedResourcesReferences MergeBehavior="Prepend">
          <LocalizedResourcesReference Language="en" LocalizedResourcesReferenceId="api.localaccountpasswordreset.en" />
          <!-- Add more languages here -->
          <LocalizedResourcesReference Language="fr" LocalizedResourcesReferenceId="api.localaccountpasswordreset.fr" />
        </LocalizedResourcesReferences>
      </ContentDefinition>
    </ContentDefinitions>

    <Localization Enabled="true">
      <SupportedLanguages DefaultLanguage="en" MergeBehavior="ReplaceAll">
        <SupportedLanguage>fr</SupportedLanguage>
        <SupportedLanguage>it</SupportedLanguage>
        <SupportedLanguage>de</SupportedLanguage>
        <SupportedLanguage>en</SupportedLanguage>
      </SupportedLanguages>

      <LocalizedResources Id="api.localaccount.emailVerification.en">
        <LocalizedStrings>
          <LocalizedString ElementType="UxElement" StringId="button_continue">Continue</LocalizedString>
        </LocalizedStrings>
      </LocalizedResources>

      <LocalizedResources Id="api.localaccount.emailVerification.fr">
        <LocalizedStrings>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="DisplayName">Adresse de messagerie</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="PatternHelpText">Entrez une adresse de messagerie valide.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="UserHelpText">Adresse de messagerie permettant de vous contacter.</LocalizedString>     
          <LocalizedString ElementType="UxElement" StringId="button_continue">Continuer</LocalizedString>
        </LocalizedStrings>
      </LocalizedResources>

      <LocalizedResources Id="api.localaccountpasswordreset.fr">
        <LocalizedStrings>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="DisplayName">Adresse de messagerie</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="PatternHelpText">Entrez une adresse de messagerie valide.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="UserHelpText">Adresse de messagerie permettant de vous contacter.</LocalizedString>     
        </LocalizedStrings>
      </LocalizedResources>

      <LocalizedResources Id="api.localaccountsignup.en">

        <LocalizedCollections>
          <LocalizedCollection ElementType="ClaimType" ElementId="extension_termsOfUseConsentChoice" TargetCollection="Restriction">
            <Item Value="AgreeToTermsOfUseConsentYes" Text=" I agree to the Terms Of Service" SelectByDefault="false" />
          </LocalizedCollection>
        </LocalizedCollections>

        <LocalizedStrings>
          <!-- Display control UI elements-->
          <LocalizedString ElementType="UxElement" StringId="button_continue">Continue</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="intro_msg">Verification is necessary. Please click Send button.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="success_send_code_msg">Verification code has been sent to your inbox. Please copy it to the input box below.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="failure_send_code_msg">We are having trouble verifying your email address. Please enter a valid email address and try again.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="success_verify_code_msg">E-mail address verified. You can now continue.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="failure_verify_code_msg">We are having trouble verifying your email address. Please try again.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="but_send_code">Send verification code</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="but_verify_code">Verify code</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="but_send_new_code">Send new code</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationControl" StringId="but_change_claims">Change e-mail</LocalizedString>
          <LocalizedString ElementType="ErrorMessage" StringId="UserMessageIfVerificationControlClaimsNotVerified">The claims for verification control have not been verified.</LocalizedString>
          <!-- Display control password reset UI elements-->
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="intro_msg">emailVerificationSSPRControl Verification is necessary. Please click Send button.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="success_send_code_msg">Verification code has been sent to your inbox. Please copy it to the input box below.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="failure_send_code_msg">We are having trouble verifying your email address. Please enter a valid email address and try again.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="success_verify_code_msg">E-mail address verified. You can now continue.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="failure_verify_code_msg">We are having trouble verifying your email address. Please try again.</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="but_send_code">Send verification code</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="but_verify_code">Verify code</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="but_send_new_code">Send new code</LocalizedString>
          <LocalizedString ElementType="DisplayControl" ElementId="emailVerificationSSPRControl" StringId="but_change_claims">Change e-mail</LocalizedString>
          <!-- Claims-->
          <LocalizedString ElementType="ClaimType" ElementId="emailVerificationCode" StringId="DisplayName">Verification Code</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="emailVerificationCode" StringId="UserHelpText">Verification code received in the email.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="emailVerificationCode" StringId="AdminHelpText">Verification code received in the email.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="DisplayName">Email</LocalizedString>
          <!-- Email validation error messages-->
          <LocalizedString ElementType="ErrorMessage" StringId="UserMessageIfInternalError">We are having trouble verifying your email address. Please try again later.</LocalizedString>
          <LocalizedString ElementType="ErrorMessage" StringId="UserMessageIfThrottled">There have been too many requests to verify this email address. Please wait a while, then try again.</LocalizedString>
          <LocalizedString ElementType="ErrorMessage" StringId="UserMessageIfChallengeExpired">That code is expired. Please request a new code.</LocalizedString>
          <LocalizedString ElementType="ErrorMessage" StringId="UserMessageIfVerificationFailedNoRetry">You've made too many incorrect attempts. Please try again later.</LocalizedString>
          <LocalizedString ElementType="ErrorMessage" StringId="UserMessageIfVerificationFailedRetryAllowed">That code is incorrect. Please try again.</LocalizedString>
        </LocalizedStrings>
      </LocalizedResources>

      <LocalizedResources Id="api.localaccountsignup.fr">
        <LocalizedCollections>
          <LocalizedCollection ElementType="ClaimType" ElementId="country" TargetCollection="Restriction">
            <Item Value="FR" Text="France" SelectByDefault="true" />
            <Item Value="AF" Text="Afghanistan" />
            <Item Value="ZA" Text="Afrique du Sud" />
            <Item Value="AL" Text="Albanie" />
            <Item Value="DZ" Text="Algérie" />
            <Item Value="DE" Text="Allemagne" />
            <Item Value="AD" Text="Andorre" />
            <Item Value="AO" Text="Angola" />
            <Item Value="AI" Text="Anguilla" />
            <Item Value="AQ" Text="Antarctique" />
            <Item Value="AG" Text="Antigua-et-Barbuda" />
            <Item Value="SA" Text="Arabie saoudite" />
            <Item Value="AR" Text="Argentine" />
            <Item Value="AM" Text="Arménie" />
            <Item Value="AW" Text="Aruba" />
            <Item Value="AU" Text="Australie" />
            <Item Value="PS" Text="Autorité palestinienne" />
            <Item Value="AT" Text="Autriche" />
            <Item Value="AZ" Text="Azerbaïdjan" />
            <Item Value="BS" Text="Bahamas" />
            <Item Value="BH" Text="Bahreïn" />
            <Item Value="BD" Text="Bangladesh" />
            <Item Value="BB" Text="Barbade" />
            <Item Value="BY" Text="Bélarus" />
            <Item Value="BE" Text="Belgique" />
            <Item Value="BZ" Text="Belize" />
            <Item Value="BJ" Text="Bénin" />
            <Item Value="BM" Text="Bermudes" />
            <Item Value="BT" Text="Bhoutan" />
            <Item Value="BO" Text="Bolivie" />
            <Item Value="BQ" Text="Bonaire" />
            <Item Value="BA" Text="Bosnie-Herzégovine" />
            <Item Value="BW" Text="Botswana" />
            <Item Value="BR" Text="Brésil" />
            <Item Value="BN" Text="Brunéi Darussalam" />
            <Item Value="BG" Text="Bulgarie" />
            <Item Value="BF" Text="Burkina Faso" />
            <Item Value="BI" Text="Burundi" />
            <Item Value="KH" Text="Cambodge" />
            <Item Value="CM" Text="Cameroun" />
            <Item Value="CA" Text="Canada" />
            <Item Value="CV" Text="Cap-Vert" />
            <Item Value="CL" Text="Chili" />
            <Item Value="CN" Text="Chine" />
            <Item Value="CY" Text="Chypre" />
            <Item Value="CO" Text="Colombie" />
            <Item Value="KM" Text="Comores" />
            <Item Value="CG" Text="Congo" />
            <Item Value="CD" Text="Congo (RDC)" />
            <Item Value="KP" Text="Corée du Nord" />
            <Item Value="KR" Text="Corée du Sud" />
            <Item Value="CR" Text="Costa Rica" />
            <Item Value="CI" Text="Côte d’Ivoire" />
            <Item Value="HR" Text="Croatie" />
            <Item Value="CU" Text="Cuba" />
            <Item Value="CW" Text="Curaçao" />
            <Item Value="DK" Text="Danemark" />
            <Item Value="DJ" Text="Djibouti" />
            <Item Value="DM" Text="Dominique" />
            <Item Value="EC" Text="Équateur" />
            <Item Value="EG" Text="Égypte" />
            <Item Value="AE" Text="Émirats arabes unis" />
            <Item Value="ER" Text="Érythrée" />
            <Item Value="ES" Text="Espagne" />
            <Item Value="EE" Text="Estonie" />
            <Item Value="SZ" Text="Eswatini" />
            <Item Value="VA" Text="État de la Cité du Vatican" />
            <Item Value="US" Text="États-Unis" />
            <Item Value="ET" Text="Éthiopie" />
            <Item Value="FJ" Text="Fidji" />
            <Item Value="FI" Text="Finlande" />
            <Item Value="GA" Text="Gabon" />
            <Item Value="GM" Text="Gambie" />
            <Item Value="GE" Text="Géorgie" />
            <Item Value="GS" Text="Géorgie du Sud et îles Sandwich du Sud" />
            <Item Value="GH" Text="Ghana" />
            <Item Value="GI" Text="Gibraltar" />
            <Item Value="GR" Text="Grèce" />
            <Item Value="GD" Text="Grenade" />
            <Item Value="GL" Text="Groenland" />
            <Item Value="GP" Text="Guadeloupe" />
            <Item Value="GU" Text="Guam" />
            <Item Value="GT" Text="Guatemala" />
            <Item Value="GG" Text="Guernesey" />
            <Item Value="GN" Text="Guinée" />
            <Item Value="GW" Text="Guinée-Bissau" />
            <Item Value="GQ" Text="Guinée équatoriale" />
            <Item Value="GY" Text="Guyana" />
            <Item Value="GF" Text="Guyane française" />
            <Item Value="HT" Text="Haïti" />
            <Item Value="HN" Text="Honduras" />
            <Item Value="HK" Text="Hong Kong (R.A.S.)" />
            <Item Value="HU" Text="Hongrie" />
            <Item Value="CK" Text="Île Bouvet" />
            <Item Value="KY" Text="Îles Caïmans" />
            <Item Value="CK" Text="Îles Cook" />
            <Item Value="FO" Text="Îles Féroé" />
            <Item Value="FK" Text="Îles Malouines" />
            <Item Value="MP" Text="Îles Mariannes du Nord" />
            <Item Value="MH" Text="Îles Marshall" />
            <Item Value="SB" Text="Îles Salomon" />
            <Item Value="TC" Text="Îles Turques-et-Caïques" />
            <Item Value="VG" Text="Îles Vierges britanniques" />
            <Item Value="VI" Text="Îles Vierges des États-Unis" />
            <Item Value="IS" Text="Islande" />
            <Item Value="IN" Text="Inde" />
            <Item Value="ID" Text="Indonésie" />
            <Item Value="IR" Text="Iran" />
            <Item Value="IQ" Text="Irak" />
            <Item Value="IE" Text="Irlande" />
            <Item Value="IL" Text="Israël" />
            <Item Value="IT" Text="Italie" />
            <Item Value="JM" Text="Jamaïque" />
            <Item Value="JP" Text="Japon" />
            <Item Value="JO" Text="Jordanie" />
            <Item Value="KZ" Text="Kazakhstan" />
            <Item Value="KE" Text="Kenya" />
            <Item Value="KG" Text="Kirghizistan" />
            <Item Value="KI" Text="Kiribati" />
            <Item Value="KW" Text="Koweït" />
            <Item Value="LA" Text="Laos" />
            <Item Value="LS" Text="Lesotho" />
            <Item Value="LV" Text="Lettonie" />
            <Item Value="LB" Text="Liban" />
            <Item Value="LR" Text="Libéria" />
            <Item Value="LY" Text="Libye" />
            <Item Value="LI" Text="Liechtenstein" />
            <Item Value="LT" Text="Lituanie" />
            <Item Value="LU" Text="Luxembourg" />
            <Item Value="MO" Text="Macao (R.A.S.)" />
            <Item Value="MK" Text="Macédoine du Nord" />
            <Item Value="MG" Text="Madagascar" />
            <Item Value="MY" Text="Malaisie" />
            <Item Value="MW" Text="Malawi" />
            <Item Value="MV" Text="Maldives" />
            <Item Value="ML" Text="Mali" />
            <Item Value="MT" Text="Malte" />
            <Item Value="MA" Text="Maroc" />
            <Item Value="MQ" Text="Martinique" />
            <Item Value="MU" Text="Maurice" />
            <Item Value="MR" Text="Mauritanie" />
            <Item Value="YT" Text="Mayotte" />
            <Item Value="MX" Text="Mexique" />
            <Item Value="FM" Text="Micronésie" />
            <Item Value="MD" Text="Moldavie" />
            <Item Value="MC" Text="Monaco" />
            <Item Value="MN" Text="Mongolie" />
            <Item Value="ME" Text="Monténégro" />
            <Item Value="MS" Text="Montserrat" />
            <Item Value="MZ" Text="Mozambique" />
            <Item Value="MM" Text="Myanmar" />
            <Item Value="NA" Text="Namibie" />
            <Item Value="NR" Text="Nauru" />
            <Item Value="NP" Text="Népal" />
            <Item Value="NI" Text="Nicaragua" />
            <Item Value="NE" Text="Niger" />
            <Item Value="NG" Text="Nigéria" />
            <Item Value="NU" Text="Niue" />
            <Item Value="NO" Text="Norvège" />
            <Item Value="NC" Text="Nouvelle-Calédonie" />
            <Item Value="NZ" Text="Nouvelle-Zélande" />
            <Item Value="OM" Text="Oman" />
            <Item Value="UG" Text="Ouganda" />
            <Item Value="UZ" Text="Ouzbékistan" />
            <Item Value="PK" Text="Pakistan" />
            <Item Value="PW" Text="Palaos" />
            <Item Value="PA" Text="Panama" />
            <Item Value="PG" Text="Papouasie-Nouvelle-Guinée" />
            <Item Value="PY" Text="Paraguay" />
            <Item Value="NL" Text="Pays-Bas" />
            <Item Value="PE" Text="Pérou" />
            <Item Value="PH" Text="Philippines" />
            <Item Value="PL" Text="Pologne" />
            <Item Value="PF" Text="Polynésie française" />
            <Item Value="PT" Text="Portugal" />
            <Item Value="PR" Text="Porto Rico" />
            <Item Value="QA" Text="Qatar" />
            <Item Value="CF" Text="République centrafricaine" />
            <Item Value="DO" Text="République dominicaine" />
            <Item Value="RO" Text="Roumanie" />
            <Item Value="GB" Text="Royaume-Uni" />
            <Item Value="RU" Text="Russie" />
            <Item Value="RW" Text="Rwanda" />
            <Item Value="KN" Text="Saint-Christophe-et-Niévès" />
            <Item Value="SH" Text="Sainte-Hélène, Ascension et Tristan da Cunha" />
            <Item Value="LC" Text="Sainte-Lucie" />
            <Item Value="PM" Text="Saint-Pierre-et-Miquelon" />
            <Item Value="VC" Text="Saint-Vincent-et-les-Grenadines" />
            <Item Value="SV" Text="Salvador" />
            <Item Value="WS" Text="Samoa" />
            <Item Value="AS" Text="Samoa américaines" />
            <Item Value="SM" Text="San Marino" />
            <Item Value="ST" Text="Sao Tomé-et-Principe" />
            <Item Value="SN" Text="Sénégal" />
            <Item Value="RS" Text="Serbie" />
            <Item Value="SC" Text="Seychelles" />
            <Item Value="SL" Text="Sierra Leone" />
            <Item Value="SG" Text="Singapour" />
            <Item Value="SK" Text="Slovaquie" />
            <Item Value="SI" Text="Slovénie" />
            <Item Value="SO" Text="Somalie" />
            <Item Value="SD" Text="Soudan" />
            <Item Value="SS" Text="Soudan du Sud" />
            <Item Value="LK" Text="Sri Lanka" />
            <Item Value="SE" Text="Suède" />
            <Item Value="CH" Text="Suisse" />
            <Item Value="SR" Text="Suriname" />
            <Item Value="SY" Text="Syrie" />
            <Item Value="TW" Text="Taïwan" />
            <Item Value="TJ" Text="Tadjikistan" />
            <Item Value="TZ" Text="Tanzanie" />
            <Item Value="TD" Text="Tchad" />
            <Item Value="CZ" Text="Tchéquie" />
            <Item Value="TH" Text="Thaïlande" />
            <Item Value="TL" Text="Timor-Leste" />
            <Item Value="TG" Text="Togo" />
            <Item Value="TK" Text="Tokelau" />
            <Item Value="TO" Text="Tonga" />
            <Item Value="TT" Text="Trinité-et-Tobago" />
            <Item Value="TN" Text="Tunisie" />
            <Item Value="TR" Text="Turquie" />
            <Item Value="TM" Text="Turkménistan" />
            <Item Value="TV" Text="Tuvalu" />
            <Item Value="UA" Text="Ukraine" />
            <Item Value="UY" Text="Uruguay" />
            <Item Value="VU" Text="Vanuatu" />
            <Item Value="VE" Text="Venezuela" />
            <Item Value="VN" Text="Vietnam" />
            <Item Value="WF" Text="Wallis-et-Futuna" />
            <Item Value="YE" Text="Yémen" />
            <Item Value="ZM" Text="Zambie" />
            <Item Value="ZW" Text="Zimbabwe" />
          </LocalizedCollection>

          <LocalizedCollection ElementType="ClaimType" ElementId="extension_termsOfUseConsentChoice" TargetCollection="Restriction">
            <Item Value="AgreeToTermsOfUseConsentYes" Text=" J'accepte les conditions d'utilisation" SelectByDefault="false" />
          </LocalizedCollection>

        </LocalizedCollections>
        <LocalizedStrings>
          <LocalizedString ElementType="UxElement" StringId="button_continue">Continuer</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="DisplayName">Adresse de messagerie</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="PatternHelpText">Entrez une adresse de messagerie valide.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="email" StringId="UserHelpText">Adresse de messagerie permettant de vous contacter.</LocalizedString>    
          <LocalizedString ElementType="ClaimType" ElementId="readonlyEmail" StringId="DisplayName">Adresse de messagerie</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="readonlyEmail" StringId="UserHelpText">Adresse de messagerie permettant de vous contacter.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="givenName" StringId="DisplayName">Prénom</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="givenName" StringId="UserHelpText">Votre prénom.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="surname" StringId="DisplayName">Nom</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="surname" StringId="UserHelpText">Votre nom de famille.</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="country" StringId="DisplayName">Pays/Région</LocalizedString>
          <LocalizedString ElementType="ClaimType" ElementId="country" StringId="UserHelpText">Pays/région où vous vous trouvez.</LocalizedString>
        </LocalizedStrings>
      </LocalizedResources>

    </Localization>

    <DisplayControls>
      <DisplayControl Id="emailVerificationControl" UserInterfaceControlType="VerificationControl">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" DefaultValue="{OIDC:LoginHint}" AlwaysUseDefaultValue="true" />
        </InputClaims>
        <DisplayClaims>
          <DisplayClaim ClaimTypeReferenceId="email" Required="true" />
          <DisplayClaim ClaimTypeReferenceId="verificationCode" ControlClaimType="VerificationCode" Required="true" />
        </DisplayClaims>
        <OutputClaims></OutputClaims>
        <Actions>
          <Action Id="SendCode">
            <ValidationClaimsExchange>
              <ValidationClaimsExchangeTechnicalProfile TechnicalProfileReferenceId="AadSspr-SendCode" />
            </ValidationClaimsExchange>
          </Action>
          <Action Id="VerifyCode">
            <ValidationClaimsExchange>
              <ValidationClaimsExchangeTechnicalProfile TechnicalProfileReferenceId="AadSspr-VerifyCode" />
            </ValidationClaimsExchange>
          </Action>
        </Actions>
      </DisplayControl>
      <DisplayControl Id="emailVerificationSSPRControl" UserInterfaceControlType="VerificationControl">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" DefaultValue="{OIDC:LoginHint}" AlwaysUseDefaultValue="true" />
        </InputClaims>
        <DisplayClaims>
          <DisplayClaim ClaimTypeReferenceId="email" Required="true" />
          <DisplayClaim ClaimTypeReferenceId="verificationCode" ControlClaimType="VerificationCode" Required="true" />
        </DisplayClaims>
        <OutputClaims></OutputClaims>
        <Actions>
          <Action Id="SendCode">
            <ValidationClaimsExchange>
              <ValidationClaimsExchangeTechnicalProfile TechnicalProfileReferenceId="AAD-CheckEmailAddressExists" />
              <ValidationClaimsExchangeTechnicalProfile TechnicalProfileReferenceId="AadSspr-SendCode">
                <Preconditions>
                  <Precondition Type="ClaimsExist" ExecuteActionsIf="false">
                    <Value>objectId</Value>
                    <Action>SkipThisValidationTechnicalProfile</Action>
                  </Precondition>
                </Preconditions>
              </ValidationClaimsExchangeTechnicalProfile>
            </ValidationClaimsExchange>
          </Action>
          <Action Id="VerifyCode">
            <ValidationClaimsExchange>
              <ValidationClaimsExchangeTechnicalProfile TechnicalProfileReferenceId="AadSspr-VerifyCode" />
            </ValidationClaimsExchange>
          </Action>
        </Actions>
      </DisplayControl>
    </DisplayControls>
  </BuildingBlocks>

  <ClaimsProviders>
    <ClaimsProvider>
      <DisplayName>Dynamic TPs</DisplayName>
      <TechnicalProfiles>
        <!--Sample: Create new technical profile based on the password reset technical profile that
            asks the user to provide and verify the email address, and returns the user object id.
            If the account doesn't exist, the technical profile return following error message "An account could not be found for the provided user ID."
            The new technical profile sets the display name to "Sign-In with Email" that is shown on the sign-up or sign-in page-->
        <TechnicalProfile Id="LocalAccountDiscoveryUsingEmailAddress-SignIn">
          <DisplayName>Sign-In with Email</DisplayName>
          <IncludeTechnicalProfile ReferenceId="LocalAccountDiscoveryUsingEmailAddress-Dynamic" />
        </TechnicalProfile>

        <!-- This technical profile forces the user to verify the email address that they provide on the UI. Only after email is verified, the user account is
        read from the directory. -->
        <TechnicalProfile Id="LocalAccountDiscoveryUsingEmailAddress-Dynamic">
          <DisplayName>Local Account Signin</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <Item Key="IpAddressClaimReferenceId">IpAddress</Item>
            <Item Key="ContentDefinitionReferenceId">api.localaccountpasswordreset</Item>
            <Item Key="SignUpTarget">SignUpWithLogonEmailExchange</Item>
            <Item Key="setting.operatingMode">Email</Item>
            <Item Key="setting.showSignupLink">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
          </Metadata>
          <CryptographicKeys>
            <Key Id="issuer_secret" StorageReferenceId="B2C_1A_TokenSigningKeyContainer" />
          </CryptographicKeys>
          <IncludeInSso>false</IncludeInSso>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="currentTime" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="email" PartnerClaimType="Verified.Email" Required="true" />
            <OutputClaim ClaimTypeReferenceId="objectId" />
            <OutputClaim ClaimTypeReferenceId="userPrincipalName" />
            <OutputClaim ClaimTypeReferenceId="authenticationSource" />
          </OutputClaims>
          <OutputClaimsTransformations>
            <OutputClaimsTransformation ReferenceId="CreateReadonlyEmailClaim" />
          </OutputClaimsTransformations>
          <ValidationTechnicalProfiles>
            <!-- check if user exists, dont throw error -->
            <ValidationTechnicalProfile ReferenceId="AAD-UserReadUsingEmailAddress-NoError" />
          </ValidationTechnicalProfiles>
          <UseTechnicalProfileForSessionManagement ReferenceId="SM-AAD" />
        </TechnicalProfile>

        <TechnicalProfile Id="AAD-UserReadUsingEmailAddress-NoError">
          <Metadata>
            <Item Key="Operation">Read</Item>
            <Item Key="RaiseErrorIfClaimsPrincipalDoesNotExist">false</Item>
          </Metadata>
          <IncludeInSso>false</IncludeInSso>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="signInNames.emailAddress" Required="true" />
          </InputClaims>
          <OutputClaims>
            <!-- Required claims -->
            <OutputClaim ClaimTypeReferenceId="objectId" />
            <OutputClaim ClaimTypeReferenceId="authenticationSource" DefaultValue="localAccountAuthentication" />

            <OutputClaim ClaimTypeReferenceId="signInNames.emailAddress" />

            <!-- Optional claims -->
            <OutputClaim ClaimTypeReferenceId="userPrincipalName" />
            <OutputClaim ClaimTypeReferenceId="displayName" />
          </OutputClaims>
          <IncludeTechnicalProfile ReferenceId="AAD-Common" />
        </TechnicalProfile>

        <!-- read the last time the user consented -->
        <TechnicalProfile Id="Check-TOU-Status">
          <Metadata>
            <Item Key="Operation">Read</Item>
            <Item Key="RaiseErrorIfClaimsPrincipalDoesNotExist">true</Item>
          </Metadata>
          <IncludeInSso>false</IncludeInSso>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="objectId" Required="true" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="displayName" />
            <OutputClaim ClaimTypeReferenceId="otherMails" />
            <OutputClaim ClaimTypeReferenceId="givenName" />
            <OutputClaim ClaimTypeReferenceId="surname" />
            <OutputClaim ClaimTypeReferenceId="extension_termsOfUseConsentDateTime" DefaultValue="2017-10-01T15:00:00.0000000Z" />
          </OutputClaims>
          <OutputClaimsTransformations>
            <OutputClaimsTransformation ReferenceId="IsTermsOfUseConsentRequiredForDateTime" />
          </OutputClaimsTransformations>
          <IncludeTechnicalProfile ReferenceId="AAD-Common" />
        </TechnicalProfile>

        <!-- write the current time to the consent attribute if the user reconsents to TOU on sign in -->
        <TechnicalProfile Id="Update-TOU-Status">
          <Metadata>
            <Item Key="Operation">Write</Item>
            <Item Key="RaiseErrorIfClaimsPrincipalDoesNotExist">true</Item>
          </Metadata>
          <IncludeInSso>false</IncludeInSso>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="objectId" Required="true" />
          </InputClaims>
          <PersistedClaims>
            <PersistedClaim ClaimTypeReferenceId="objectId" />
            <PersistedClaim ClaimTypeReferenceId="currentTime" PartnerClaimType="extension_termsOfUseConsentDateTime" />
          </PersistedClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="termsOfUseConsentRequired" DefaultValue="false" AlwaysUseDefaultValue="true" />
          </OutputClaims>
          <IncludeTechnicalProfile ReferenceId="AAD-Common" />
        </TechnicalProfile>

        <TechnicalProfile Id="Get-Current-Time">
          <DisplayName>Get current time</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="currentTime" />
          </OutputClaims>
          <OutputClaimsTransformations>
            <OutputClaimsTransformation ReferenceId="GetCurrentDateTime" />
          </OutputClaimsTransformations>
        </TechnicalProfile>

      </TechnicalProfiles>
    </ClaimsProvider>

    <ClaimsProvider>
      <DisplayName>Username based Sign Up</DisplayName>
      <TechnicalProfiles>
        <!--Sign-up self-asserted technical profile without Email verification-->
        <TechnicalProfile Id="LocalAccountSignUpWithReadOnlyEmail_Implicit">
          <DisplayName>Email signup</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.localaccountsignup</Item>
            <!-- Remove sign-up email verification -->
            <Item Key="EnforceEmailVerification">False</Item>
          </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="GetCurrentDateTime" />
          </InputClaimsTransformations>
          <InputClaims>
            <!--Sample: Set input the ReadOnlyEmail claim type to prefilled the email address-->
            <InputClaim ClaimTypeReferenceId="readOnlyEmail" />
            <InputClaim ClaimTypeReferenceId="extension_termsOfUseConsentChoice" DefaultValue="AgreeToTermsOfUseConsentNo" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="objectId"/>
            <OutputClaim ClaimTypeReferenceId="readOnlyEmail" Required="true" />
            <!-- Sample: remove the password claims
            <OutputClaim ClaimTypeReferenceId="newPassword" Required="true"/>
            <OutputClaim ClaimTypeReferenceId="reenterPassword" Required="true"/> -->
            <OutputClaim ClaimTypeReferenceId="executed-SelfAsserted-Input" DefaultValue="true"/>
            <OutputClaim ClaimTypeReferenceId="authenticationSource"/>
            <OutputClaim ClaimTypeReferenceId="newUser"/>

            <!-- Additional claims, to be collected from the user -->
            <OutputClaim ClaimTypeReferenceId="givenName" Required="true" />
            <OutputClaim ClaimTypeReferenceId="surName" Required="true" />
            <OutputClaim ClaimTypeReferenceId="country" Required="true" />
            <OutputClaim ClaimTypeReferenceId="extension_termsOfUseConsentChoice" Required="true" />
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="AAD-UserWriteUsingLogonEmail-Custom"/>
          </ValidationTechnicalProfiles>
          <UseTechnicalProfileForSessionManagement ReferenceId="SM-AAD" />
        </TechnicalProfile>

        <!-- During sign up, write the current time of consent, and version -->
        <TechnicalProfile Id="AAD-UserWriteUsingLogonEmail-Custom">
          <Metadata>
            <Item Key="Operation">Write</Item>
            <Item Key="RaiseErrorIfClaimsPrincipalAlreadyExists">true</Item>
          </Metadata>
          <IncludeInSso>false</IncludeInSso>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CopyEmailAddressIntoDisplayName" /> <!-- copy email address to displayName -->
            <!--Sample: create a random password-->
            <InputClaimsTransformation ReferenceId="CreateRandomPassword" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="signInNames.emailAddress" Required="true"/>
          </InputClaims>
          <PersistedClaims>
            <!-- Required claims -->
            <PersistedClaim ClaimTypeReferenceId="email" PartnerClaimType="signInNames.emailAddress"/>
            <PersistedClaim ClaimTypeReferenceId="displayName" DefaultValue="unknown"/>

            <PersistedClaim ClaimTypeReferenceId="newPassword" PartnerClaimType="password"/>
            <PersistedClaim ClaimTypeReferenceId="passwordPolicies" DefaultValue="DisablePasswordExpiration, DisableStrongPassword"/>

            <!-- Additional claims. -->
            <PersistedClaim ClaimTypeReferenceId="givenName"/>
            <PersistedClaim ClaimTypeReferenceId="surname"/>
            <PersistedClaim ClaimTypeReferenceId="country"/>
            <PersistedClaim ClaimTypeReferenceId="currentTime" PartnerClaimType="extension_termsOfUseConsentDateTime" />
            <PersistedClaim ClaimTypeReferenceId="extension_termsOfUseConsentChoice" />
            <PersistedClaim ClaimTypeReferenceId="extension_termsOfUseConsentVersion" DefaultValue="V1" />
          </PersistedClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="objectId"/>
            <OutputClaim ClaimTypeReferenceId="newUser" PartnerClaimType="newClaimsPrincipalCreated"/>
            <OutputClaim ClaimTypeReferenceId="authenticationSource" DefaultValue="localAccountAuthentication"/>
            <OutputClaim ClaimTypeReferenceId="userPrincipalName"/>
            <OutputClaim ClaimTypeReferenceId="signInNames.emailAddress"/>
          </OutputClaims>
          <IncludeTechnicalProfile ReferenceId="AAD-Common"/>
          <UseTechnicalProfileForSessionManagement ReferenceId="SM-AAD"/>
        </TechnicalProfile>

      </TechnicalProfiles>
    </ClaimsProvider>

    <ClaimsProvider>
      <!-- Page that prompts for a new TOU on sign in if the users TOU is out of date-->
      <DisplayName>Self Asserted</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="SelfAsserted-Input-ToU-SignIn">
          <DisplayName>Self Asserted ToU</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.selfasserted</Item>
            <Item Key="AllowGenerationOfClaimsWithNullValues">true</Item>
          </Metadata>
          <CryptographicKeys>
            <Key Id="issuer_secret" StorageReferenceId="B2C_1A_TokenSigningKeyContainer" />
          </CryptographicKeys>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="objectId" />
            <InputClaim ClaimTypeReferenceId="extension_termsOfUseConsentChoice" DefaultValue="AgreeToTermsOfUseConsentNo" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="termsOfUseConsentRequired" />
            <OutputClaim ClaimTypeReferenceId="extension_termsOfUseConsentChoice" Required="true" />
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="Update-TOU-Status" />
          </ValidationTechnicalProfiles>
        </TechnicalProfile>
      </TechnicalProfiles>
    </ClaimsProvider>
  </ClaimsProviders>

  <UserJourneys>
    <UserJourney Id="SignUpOrSignInPasswordless" NonInteractive="false">
      <OrchestrationSteps>
        <OrchestrationStep Order="1" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="Get-Current-Time" TechnicalProfileReferenceId="Get-Current-Time" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <ClaimsExchanges>
            <!--Sample: the sign-in with email claims exchange-->
            <ClaimsExchange Id="SignIn-WithEmail" TechnicalProfileReferenceId="LocalAccountDiscoveryUsingEmailAddress-SignIn" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <!-- Run this step when a user tries to sign-in with unregistered account -->
        <OrchestrationStep Order="3" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimsExist" ExecuteActionsIf="true">
              <Value>objectId</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <!--Sample: the sign-in with email claims exchange-->
            <ClaimsExchange Id="SignUp-WithReadOnlyEmail" TechnicalProfileReferenceId="LocalAccountSignUpWithReadOnlyEmail_Implicit" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <!-- This step reads any user attributes that we may not have received when authenticating using ESTS so they can be sent 
          in the token. -->
        <OrchestrationStep Order="4" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="AADUserReadWithObjectId" TechnicalProfileReferenceId="AAD-UserReadUsingObjectId" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="5" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="Check-TOU-Status" TechnicalProfileReferenceId="Check-TOU-Status" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <!-- Display Terms of Use consent page for any SignIn scenario based on termsOfUseConsentRequired claim -->
        <OrchestrationStep Order="6" Type="ClaimsExchange">
          <Preconditions>
            <!-- Add condition to not execute this step for sign up scenario based on newUser claim -->
            <Precondition Type="ClaimsExist" ExecuteActionsIf="true">
              <Value>newUser</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>termsOfUseConsentRequired</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="ShowToUConsentPageForNewUser" TechnicalProfileReferenceId="SelfAsserted-Input-ToU-SignIn" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="7" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer" />

      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb" />
    </UserJourney>
  </UserJourneys>

</TrustFrameworkPolicy>
